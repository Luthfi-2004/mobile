<ion-header>
  <ion-toolbar color="light">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/riwayat"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ viewOnly ? 'Lihat Penilaian' : 'Beri Penilaian' }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding" style="background-color: #a6ddf0">
  <div class="rating-section">
    <h2>Makanan</h2>
    <div class="stars">
      <ion-icon
        *ngFor="let star of stars; let i = index"
        [name]="i < ratingMakanan ? 'star' : 'star-outline'"
        [class.disabled]="ulasanSudahAda || viewOnly"
        (click)="(!ulasanSudahAda && !viewOnly) && setRating('makanan', i + 1)"
        color="warning"
        class="star-icon"
      ></ion-icon>
    </div>
  </div>

  <div class="rating-section">
    <h2>Pelayanan</h2>
    <div class="stars">
      <ion-icon
        *ngFor="let star of stars; let i = index"
        [name]="i < ratingPelayanan ? 'star' : 'star-outline'"
        [class.disabled]="ulasanSudahAda || viewOnly"
        (click)="(!ulasanSudahAda && !viewOnly) && setRating('pelayanan', i + 1)"
        color="warning"
        class="star-icon"
      ></ion-icon>
    </div>
  </div>

  <div class="rating-section">
    <h2>Aplikasi</h2>
    <div class="stars">
      <ion-icon
        *ngFor="let star of stars; let i = index"
        [name]="i < ratingAplikasi ? 'star' : 'star-outline'"
        [class.disabled]="ulasanSudahAda || viewOnly"
        (click)="(!ulasanSudahAda && !viewOnly) && setRating('aplikasi', i + 1)"
        color="warning"
        class="star-icon"
      ></ion-icon>
    </div>
  </div>

  <div class="rating-section">
    <h2>Saran / Komentar</h2>
    <ion-textarea
      [(ngModel)]="feedback"
      (ionInput)="onFeedbackChange()"
      placeholder="Tulis saran atau komentar Anda di sini..."
      autoGrow="true"
      class="feedback-textarea"
      [readonly]="ulasanSudahAda || viewOnly"
    ></ion-textarea>
  </div>

  <!-- Show message if viewing existing rating -->
  <div class="existing-rating-info ion-text-center" *ngIf="viewOnly || ulasanSudahAda" style="margin-top: 20px;">
    <ion-chip color="success">
      <ion-icon name="checkmark-circle" color="success"></ion-icon>
      <ion-label>Penilaian sudah diberikan</ion-label>
    </ion-chip>
    <p class="ion-text-center" style="margin-top: 10px; color: #666;">
      <small>Terima kasih atas penilaian Anda!</small>
    </p>
  </div>

  <!-- Submit button - only show if not view only and not already rated -->
  <div class="thank-you ion-text-center" style="margin-top: 40px;" *ngIf="!ulasanSudahAda && !viewOnly">
    <h3>Terima Kasih.</h3>
    <ion-button expand="block" shape="round" color="medium" (click)="simpanPenilaian()">
      Simpan Penilaian
    </ion-button>
  </div>
</ion-content>